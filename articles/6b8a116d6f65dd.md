---
title: "PokeAPIでゼロから作るクイズPWA：クリスマスプレゼント作りの記録"
emoji: "🎮"
type: "tech"
topics: ["pokeapi", "javascript", "pwa", "web", "frontend"]
published: true
---

とあるアドベントカレンダーの18日目の記事です

## はじめに
子どもへのクリスマスプレゼントについて、夫婦で相談した結果、ポケモン図鑑のゲームをプレゼントしようとなりました。
検索しても、まだゲーム会社から発売前でしたので、夫婦で作ることにしました。
子どもを寝かしつけた後の時間を使い、夫婦で20時から23時の3時間以内に作り切ることを目標としました。

## やったこと
PokeAPIを使って、子どもでも遊べるシンプルなクイズアプリ（PWA）をゼロから開発しました。画像をランダム表示し、クリックで名前（日本語）、タイプ（日本語）、つよさ（種族値合計）を表示します。子どもからどっちのポケモンが強いのかとよく聞かれるため、つよさは種族値合計値を用いることにしました。GitHub Pagesにデプロイし、PWAとすることでスマホのホーム画面から起動できるようにしました。

## 要件整理
- ランダムにポケモンを1体出題（画像）
- クリックで答えを表示（名前・タイプ・つよさ）
- もう一度クリックで次の問題へ
- PWA対応（ホーム画面追加・オフライン起動）
- アクセシビリティ配慮（キーボード操作・ARIA）
- GitHub Pages公開

## 技術選定
- フロントエンド: 素のHTML/CSS/JavaScript（依存最小）
- データ取得: PokeAPI（`/pokemon/{id}` と `/pokemon-species/{id}`）
- PWA: Manifest + Service Worker（キャッシュ戦略はApp Shell中心）
- ホスティング: GitHub Pages（プロジェクトサイト）

## ファイル構成（最終）
- index.html : マークアップ、情報欄（名前・タイプ・つよさ）、カードUI
- styles.css : タイプ色用のCSS変数、ダークモード、バッジ/ヒントのスタイル
- app.js : 乱数出題、PokeAPI取得、クリック時の表示制御、タイプ色反映
- manifest.webmanifest : PWAメタデータ（`start_url`/`scope`）
- service-worker.js : キャッシュとナビゲーションフォールバック

## 実装ステップ
### 1. 初期UI（画像・カード・ヒント）
- `index.html` にカード（画像・クリック用）とヒント文を配置
- `.card` は `role="button"` と `tabindex="0"` でキーボード操作を可能に

### 2. ランダム出題ロジック
- `MAX_ID` を設定し、`getRandomId()` で1〜MAXの乱数を生成
- `/pokemon/{id}` から画像URL（公式アート優先）、タイプ配列、種族値を取得
- `/pokemon-species/{id}` から日本語名（`ja-Hrkt`）を抽出

### 3. クリック時の表示制御
- 読み込み時は画像のみ表示、値は `state` に保持（`jpName`/`types`/`strength`）
- 初回クリックでカード内に名前、カード外の情報欄（日本語タイプ＆つよさ）を表示
- 2回目クリックで次のポケモンをロード

### 4. タイプ色の適用
- `TYPE_COLORS`（英語タイプ→色）を定義
- CSS変数 `--type-color` を更新し、`body` 背景色に反映
- ダークモードでは `color-mix(in oklab, ...)` を使って馴染ませる

### 5. 日本語タイプ表記
- `TYPE_LABEL_JA` を用意（例: `grass`→`くさ`、`fire`→`ほのお`）
- バッジのテキストは日本語、`title` 属性に英語名を残しておく

### 6. PWA対応（GitHub Pagesのパス調整）
- `manifest.webmanifest`
  - `start_url` と `scope` をプロジェクトパス（例: `/pokeapi-app/`）に統一
- `app.js`
  - `navigator.serviceWorker.register('service-worker.js', { scope: './' })`
- `service-worker.js`
  - `self.registration.scope` を基準にアセットURLを構築
  - `skipWaiting()`/`clients.claim()` で更新反映を早くする
  - `navigate` フォールバックに `index.html` を使用

## コードの要点
- 画像がない個体へのリトライ（最大5回）で体感安定性を向上
- カードのクリックとキーボード（Enter/Space）で同じ処理を呼び出し
- 旧HTMLキャッシュでも例外で止まらないよう、描画先要素へのガード追加

## ハマりポイントと対処
- GitHub Pagesの「There isn't a GitHub Pages site here.」
  - `start_url`/`scope`/SWの絶対パスがドメイン直下を向いていた → プロジェクトパスに修正
- PWAキャッシュが強く、更新が見えない
  - 強制再読み込み、PWAの再追加、必要に応じてサイトデータ削除

## デプロイ（GitHub Pages）
`main` にpushするとActionsが `upload-pages-artifact`→`deploy-pages` で自動公開。
pushするだけで、PWAに修正が反映されるため、修正が捗った。
開発初期にGithub Actionsを利用してよかった。


## 今後の拡張
- 複合タイプ時のグラデーション背景やアイコン
- クイズスコア・出題履歴のオフライン保存
- 多言語対応（UIラベルの切替）

## 参考
- PokeAPI: https://pokeapi.co/
- PWA/Service Worker: https://developer.mozilla.org/docs/Web/Progressive_web_apps
- GitHub Pages: https://docs.github.com/pages
