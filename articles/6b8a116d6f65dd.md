---
title: "夫婦で作るクリスマスプレゼント開発記：PokeAPI × PWA"
emoji: "🎮"
type: "tech"
topics: ["pokeapi", "javascript", "pwa", "web", "pokemon"]
published: true
published_at: 2025-12-19 00:00
---

**この記事は同僚とやっているアドベントカレンダーの19日目の記事です**

## はじめに
子どもへのクリスマスプレゼントについて夫婦で相談した結果、ポケモン図鑑のクイズゲームを贈ることにしました。しかし、そういったゲームはまだゲーム会社から発売されていなかったため、夫婦で手作りすることに決めました。
子どもを寝かしつけた後の時間を活用し、20時から23時までの3時間以内に完成させることを目標に、夫婦で制作に取り組みました。

## 作ったもの
PokeAPIを使って、子どもでも遊べるシンプルなクイズアプリ（PWA）をゼロから開発しました。

https://yamatokat.github.io/pokeapi-app/

- 画像をランダム表示し、クリックで名前、タイプ、つよさ（種族値の合計）を表示
- 名前とタイプはほぼ覚えているため採用し、子どもからどっちのポケモンが強いのかとよく聞かれるため、つよさは種族値の合計値を用いる
- 何問クイズに回答できたか把握できるように出題数を表示
- GitHub Pagesにデプロイし、PWAとすることでスマホのホーム画面から起動できるように


## 要件整理
- ランダムにポケモンを1体出題（画像）
- クリックで答えを表示（名前・タイプ・つよさ）
- もう一度クリックで次の問題へ
- PWA対応（ホーム画面追加・オフライン起動）
- アクセシビリティ配慮（キーボード操作・ARIA）
- GitHub Pages公開
- アクセス数や出題数をキャッシュとして保持

## 技術選定
- フロントエンド: 素のHTML/CSS/JavaScript（依存最小）
- データ取得: PokeAPI（`/pokemon/{id}` と `/pokemon-species/{id}`）
  - スクレイピングするサイトを探していたら、**オープンソースのRest APIを見つけ利用**
- PWA: Manifest + Service Worker（キャッシュ戦略はApp Shell中心）
- ホスティング: GitHub Pages（プロジェクトサイト）

## ファイル構成（最終）
詳細はGitリポジトリ参照
- index.html : マークアップ、情報欄（名前・タイプ・つよさ）、カードUI
- styles.css : タイプ色用のCSS変数、ダークモード、バッジ/ヒントのスタイル
- app.js : 乱数出題、PokeAPI取得、クリック時の表示制御、タイプ色反映
- manifest.webmanifest : PWAメタデータ（`start_url`/`scope`）
- service-worker.js : キャッシュとナビゲーションフォールバック

## 実装ステップ
### 1. 初期UI（画像・カード・ヒント）
- `index.html` にカード（画像・クリック用）とヒント文を配置
- `.card` は `role="button"` と `tabindex="0"` でキーボード操作を可能に

### 2. ランダム出題ロジック
- `MAX_ID` を設定し、`getRandomId()` で1〜MAXの乱数を生成
- `/pokemon/{id}` から画像URL（公式アート優先）、タイプ配列、種族値を取得
- `/pokemon-species/{id}` から日本語名（`ja-Hrkt`）を抽出

### 3. クリック時の表示制御
- 読み込み時は画像のみ表示、値は `state` に保持（`jpName`/`types`/`strength`）
- 初回クリックでカード内に名前、カード外の情報欄（日本語タイプ＆つよさ）を表示
- 2回目クリックで次のポケモンをロード

### 4. タイプ色の適用
- `TYPE_COLORS`（英語タイプ→色）を定義
- CSS変数 `--type-color` を更新し、`body` 背景色に反映
- ダークモードでは `color-mix(in oklab, ...)` を使って馴染ませる

### 5. 日本語タイプ表記
- `TYPE_LABEL_JA` を用意（例: `grass`→`くさ`、`fire`→`ほのお`）
- バッジのテキストは日本語、`title` 属性に英語名を残しておく

### 6. PWA対応（GitHub Pagesのパス調整）
- `manifest.webmanifest`
  - `start_url` と `scope` をプロジェクトパス（例: `/pokeapi-app/`）に統一
- `app.js`
  - `navigator.serviceWorker.register('service-worker.js', { scope: './' })`
- `service-worker.js`
  - `self.registration.scope` を基準にアセットURLを構築
  - `skipWaiting()`/`clients.claim()` で更新反映を早くする
  - `navigate` フォールバックに `index.html` を使用

## コードの要点
- 画像がない個体へのリトライ（最大5回）で体感安定性を向上
- カードのクリックとキーボード（Enter/Space）で同じ処理を呼び出し
- 旧HTMLキャッシュでも例外で止まらないよう、描画先要素へのガード追加

## ハマりポイントと対処
- GitHub Pagesの「There isn't a GitHub Pages site here.」
  - `start_url`/`scope`/SWの絶対パスがドメイン直下を向いていた → プロジェクトパスに修正
- 実機テストで、PWAキャッシュが強く、修正した箇所の更新が反映されない
  - 強制再読み込み、PWAの再追加、サイトデータ削除を実施

## デプロイ（GitHub Pages）
`main` にpushするとActionsが `upload-pages-artifact`→`deploy-pages` で自動公開。
pushするだけで、PWAに修正が反映されるため、修正が捗った。
**開発初期にGithub Actionsを設定し、利用することをオススメする**


## 今後の拡張
- 複合タイプ時のグラデーション背景やアイコン
- クイズスコア・出題履歴のオフライン保存
- 何かしらの対戦要素の追加
  - 勝敗が生まれるインタラクションを加えることで、挑戦欲求と達成感を刺激し、プレイ体験を深化

## 参考
- PokeAPI: https://pokeapi.co/
- PWA/Service Worker: https://developer.mozilla.org/docs/Web/Progressive_web_apps
- GitHub Pages: https://docs.github.com/pages
